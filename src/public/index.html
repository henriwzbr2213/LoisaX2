<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>LoisaX2 Panel</title>
  <style>
    body{font-family:Arial,sans-serif;max-width:900px;margin:24px auto;padding:0 16px}
    .row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    button{padding:8px 12px;cursor:pointer}
    pre{background:#111;color:#0f0;padding:12px;border-radius:8px;min-height:130px;overflow:auto}
    .card{border:1px solid #ddd;border-radius:10px;padding:12px;margin:12px 0}
  </style>
</head>
<body>
  <h1>LoisaX2 Frontend (Admin + Client)</h1>
  <div class="card">
    <h3>Login</h3>
    <div class="row">
      <select id="users"></select>
      <button onclick="login()">Entrar</button>
    </div>
    <p id="session"></p>
  </div>

  <div class="card">
    <h3>Client Panel</h3>
    <div class="row">
      <button onclick="listClientServers()">Meus servidores</button>
      <input id="identifier" placeholder="identifier" />
      <button onclick="power('start')">Start</button>
      <button onclick="power('stop')">Stop</button>
      <button onclick="power('restart')">Restart</button>
      <button onclick="consoleCreds()">Console WS</button>
    </div>
  </div>

  <div class="card">
    <h3>Admin Panel</h3>
    <div class="row">
      <button onclick="listAdminServers()">Todos servidores</button>
      <button onclick="listAudit()">Audit</button>
    </div>
  </div>

  <pre id="out"></pre>

<script>
let token='';
const out=document.getElementById('out');
const usersSel=document.getElementById('users');

async function api(path, options={}) {
  const res=await fetch(path,{...options,headers:{'Content-Type':'application/json','Authorization': token?`Bearer ${token}`:'',...(options.headers||{})}});
  const data=await res.json().catch(()=>({}));
  if(!res.ok) throw data;
  return data;
}

async function loadUsers(){
  const users=await api('/auth/users');
  usersSel.innerHTML=users.map(u=>`<option value="${u.id}">${u.username} (${u.role})</option>`).join('');
}

async function login(){
  const data=await api('/auth/login',{method:'POST',body:JSON.stringify({userId:usersSel.value})});
  token=data.token;
  document.getElementById('session').innerText=`Logado como ${data.user.username} (${data.user.role})`;
}

async function listClientServers(){ try{ out.textContent=JSON.stringify(await api('/client/servers'),null,2);}catch(e){out.textContent=JSON.stringify(e,null,2)} }
async function listAdminServers(){ try{ out.textContent=JSON.stringify(await api('/admin/servers'),null,2);}catch(e){out.textContent=JSON.stringify(e,null,2)} }
async function listAudit(){ try{ out.textContent=JSON.stringify(await api('/admin/audit'),null,2);}catch(e){out.textContent=JSON.stringify(e,null,2)} }
async function power(signal){ try{ await api(`/client/servers/${document.getElementById('identifier').value}/power`,{method:'POST',body:JSON.stringify({signal})}); out.textContent='ok';}catch(e){out.textContent=JSON.stringify(e,null,2)} }
async function consoleCreds(){ try{ out.textContent=JSON.stringify(await api(`/client/servers/${document.getElementById('identifier').value}/console`),null,2);}catch(e){out.textContent=JSON.stringify(e,null,2)} }

loadUsers().catch(err=>out.textContent=JSON.stringify(err,null,2));
</script>
</body>
</html>
